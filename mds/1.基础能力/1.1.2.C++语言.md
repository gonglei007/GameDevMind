<h2 align="center">C++语言</h2>
<p>
C++是一个历史悠久、应用广泛的编程语言，在前端开发、后端开发、工具开发等都有广泛的应用。
</p>

**关键词:**<br/>
*C++,指针,内存越界,引用,模板,STL,内存泄露*

----
## 语言应用

### 是什么？在哪用？

- **为什么选择C++来开发游戏？**
  - C++够"低级"，它允许你控制所有底层的东西，比如内存、指令、硬件。你几乎可以知道你的一段代码编程CPU指令后是什么样的
  - C++开发效率不是那么高，因为你有很多的细节要自己去控制把握。但它的运行效率非常的高（只要你掌握的足够好、优化的足够好）。甚至一些主机硬件会针对C++做优化
  - 如果你的应用场景是需要你的程序、模块、系统高度优化（可能是硬件限制、可能是成本考量），就可以考虑使用C++语言

- **游戏开发中可能有哪些场景会使用C++？**
  - **引擎开发**：引擎的运行时库是需要最大化的运行效率的
  - **服务器开发**：在用户量大的时候，尽力发挥每台服务器的效能，提高性价比
  - **工具开发**：有些高性能需求工具，可以考虑用C++进行开发

## 数据类型

### 会遇到哪些问题？用什么解决？

- **溢出问题**
  - **问题**：整形运算的值超出了32位，在32位的系统上，有个跟时间增长相关的变量，程序跑半个月，数值就可能溢出了，就会产生相关的bug
  - **解决方向**：注意运算顺序，例如 `D = A * B / C` 改为 `D = A / C * B` 更安全一点

- **精度问题**
  - **问题**：数字太小（小数位太多） - 小数点后N位就无法正确计算了。图形编程中的Z闪烁就是精度问题导致的
  - **解决方向**：根据精度需求选择合适的浮点类型，注意浮点数的精度限制

- **有损截断（Lossy Narrowing/Truncation）**
  - **问题**：当用高精度数据类型给低精度数据类型赋值的时候，数据会被破坏性的转化
  - **解决方向**：使用 `narrow_cast` 等安全的类型转换方法，明确标识可能的数据损失

## 指针

### 是什么？在哪用？

- **说明**：指针是一个变量，这个变量存储的内容是一个地址，指向内存的一个存储单元
- **意义**：指针可以让你只动结构，不动内容。也就是说，可以只换门牌号，而不用让人去搬家

### 会遇到哪些问题？用什么解决？

- **野指针（Wild Pointer/Dangling Pointer）**
  - **问题**：指针变量原来指向的变量/对象释放了，这块内存可能被释放了，也可能后来又被分配它用了。这时候这个指针还在，如果再针对这个指针所指的地址做原来的那些操作，事情就乱套了
  - **解决方向**：指针释放后及时置空，使用智能指针管理内存生命周期

## 指针与数组

### 是什么？在哪用？

- **区别**：指针和数组在内存访问上有不同的行为
- **sizeof**：用于计算数据大小，指针和数组的 sizeof 结果不同
- **指针运算**：`char : v+1` 与 `pointer: v+1` 的步进距离不同

## 引用

### 是什么？在哪用？

- **说明**：相当于一个变量的别名，它本身不占用额外的内存
- **应用场景**：函数参数传递、避免指针的空指针问题

### 会遇到哪些问题？

- **注意**：指针的引用和变量的引用在使用上有区别，需要明确理解

## 字符串

### 会遇到哪些问题？

- **长度问题**：字符串长度计算和边界处理
- **字符类型 vs 字符串类型**：`"a"` 与 `'a'` 的区别，一个是字符串，一个是字符

## 智能指针

### 是什么？在哪用？

- **作用**：解决内存泄露的问题
- **内部实现**：
  - 重载了 `*` 和 `->` 运算符
  - 通过引用计数来判断对象是否在用，是否超出了范围，来决定是否释放内存

### 应用场景

- 自动管理对象生命周期
- 避免手动 new/delete 导致的内存泄漏

## 内存

### 会遇到哪些问题？用什么解决？

- **写内存越界**
  - **问题**：C/C++的特点是"自由"，它不管你怎么读写内存，想写到哪里都可以
  - **危害**：
    - 很难知道什么东西被写坏了
    - 很难知道被什么写坏了
    - 错误表现通常无厘头
  - **容易出现越界的操作**：字符串操作、内存操作、指针操作
  - **解决方向**：使用安全的字符串函数，边界检查，使用容器替代原始数组

- **内存泄露**
  - **问题**：分配的内存没有正确释放
  - **排查**：借用工具来排查内存泄露
  - **解决方向**：可通过使用智能指针来避免内存泄露

- **内存碎片**
  - **问题**：运行时持续的分配、释放内存，这样会产生内存碎片
  - **解决方向**：使用内存池来管理内存分配

- **内存对齐**
  - **说明**：CPU一次取一批数据，CPU取数据的位置是有对齐规则的
  - **为什么对齐**：为了CPU的数据读取性能
  - **应用场景**：优化内存使用、对象序列化

### 是什么？在哪用？

- **内存分布**：
  - 计算内存数据长度
  - 调试指针指向

## 条件语句

### 会遇到哪些问题？用什么解决？

- **代码块遗漏大括号**
  - **问题**：单行 if 语句容易导致逻辑错误
  - **解决方向**：为了减少bug出现几率，尽量都是用 `{}` 括起来

## STL（标准模板库）

### 是什么？在哪用？

- **容器**：
  - **vector**：动态数组
  - **list**：双向链表
  - **queue**：队列
  - **map**：内部是根据key（红黑树）排序的。如果需要对顺序数据排序，可以借用

- **应用举例**：
  - 事件系统
  - 对象管理

### 会遇到哪些问题？用什么解决？

- **性能问题**
  - **问题**：容器在运行时动态扩容会导致内存的动态分配和碎片，进而影响性能
  - **解决方向**：尽量在初始化的时候，就把容器的可能空间确定好。这样可以减少在运行时动态的给容器扩容

## 模板（template）

### 是什么？在哪用？

- **作用**：实现对不同类型数据的统一管理
- **应用举例**：
  - **容器**：存储不特定类型的数据（对象）
  - **事件机制**：处理不同类型的事件
  - **3D数据处理**：比如mesh的顶点数据可能有不同的数据类型，但对这些数据进行的操作是相同的

## Bit masking

### 是什么？在哪用？

- **作用**："多快好省"的存储和操作数据
- **应用举例**：多开关状态存储

## cast

### 是什么？在哪用？

- **作用**：类型转换。不同于强制类型转换，使用cast转换会对转化类型进行检查
- **优势**：提供类型安全的转换，避免不安全的类型转换导致的问题

## 宏

### 是什么？在哪用？

- **应用场景**：
  - 编译配置中可以针对不同的编译平台配置不同的宏
  - 版本平台差异的区分

### 会遇到哪些问题？

- **注意**：宏只是将其定义的那段字符串展开到使用的代码位置，所以它定义的内容不能被当成一个整体来处理，本身也无语法定义。结果如何是看被展开以后，那个地方的整体代码的效果

## inline

### 是什么？在哪用？

- **作用**：inline的函数会在调用的地方被展开，相当于把函数内的代码插入到调用的地方
- **建议**：如果一个函数比较小，在代码中又多次调用，可以加inline

## 库文件

### 是什么？在哪用？

- **作用**：库文件可以理解为一个模块/系统的封装

- **静态库**
  - **作用**：给程序编译用的
  - **应用**：如果你的库是想给不同的开发者拿去集成功能的，就做成静态库

- **动态库**
  - **作用**：给程序运行用的
  - **应用**：如果你的库是想给不同的程序去运行调用的，就做成动态库

## 编译器

### 是什么？在哪用？

- **过程**：编译、链接
- **Makefile**：
  - **作用**：一个工程有大量的文件，文件之间有各种依赖关系。makefile就是用来配置这个关系的，然后告诉编译器如何来编译这些文件并产生结果
  - **补充说明**：有些IDE把这些文件关系都集成到IDE的（图形界面中的）工程管理配置中去了

- **可选择的C++编译器**：
  - **gcc**：支持交叉编译（在一个平台上编译生成在另一个平台上运行的可执行文件）
  - **mingw**
  - **clang**

### 会遇到哪些问题？用什么解决？

- **编译链接警告**
  - **问题**：警告通常会反应出来潜在的bug
  - **解决方向**：尽量将警告视为错误，去处理掉它！

## 更多资料

### 训练资料
* [【推荐】C++找bug训练](https://github.com/gonglei007/cpp-bugs-killer) - 一个有意思的C++训练项目，通过分析代码bug来熟悉C++语言的特性。里面提供了很多种C++的bug示例代码。
* [Program Bug Examples](https://courses.cs.vt.edu/~cs2204/summer2004/readings/bugexamples.htm)

### 在线资料
* [如何设计内存池？](https://www.zhihu.com/question/25527491/answer/2629173868)
* [C++ 智能指针最佳实践&源码分析](https://zhuanlan.zhihu.com/p/436290273) - 介绍智能指针可以解决的问题，用法及最佳实践。并且根据源码分析智能指针的实现原理。
* [Smart Pointers in C++ and How to Use Them](https://www.geeksforgeeks.org/smart-pointers-cpp/) - 讨论 C++ 中的智能指针。什么是智能指针，为什么以及如何正确使用它们？
* [C++中Crash定位原理与常见案例反汇编分析](https://zhuanlan.zhihu.com/p/412102389) - 本文主要C++中crash解析定位原理，讨论为什么能解析出堆栈？如何找到函数名称？如何定位出C++源文件的行号？crash时寄存器值有什么意义？以及遇到crash时如何应对。
* [游戏开发面试答案篇（一）-- C++篇](https://mp.weixin.qq.com/s/A2rIUY10fd8inNbBRdzzXg)
* [C++ core guideline ES.46: Avoid lossy (narrowing, truncation) arithmetic conversion](https://blog.fearcat.in/a?ID=01750-ce228fbb-e010-4b9a-93d1-2a56247a5bfc) - 关于避免有损截断的指南
 
### 视频资料
* [你应该掌握的10个现代 C++ 特性](https://www.youtube.com/watch?v=y6widqVUlb4)

### 培训
* [Boolan](http://boolan.com) - C++培训
