<h2 align="center">客户端3D场景开发</h2>
<p>
3D游戏中会有各种各样的场景表现，看看实现他们都要考虑哪些问题。3D场景开发涉及地形、地图、植物、天气、光照等多个方面，每个方面都有其特定的技术挑战和解决方案。
</p>

**关键词:**<br/> 
*客户端3D场景开发,地形,地图,植物,云层,天空体,波浪,天气,时间,室内场景,战争迷雾,Height Map,高度图,法线计算,LOD,细节层次,可见性,Tiled Map,瓦片贴图,Blend Map,混合贴图,Mipmap,Perlin noise,六边形地图,渲染顺序,可见性优化,动画,音效,SpeedTree,天空盒,昼夜变化,光照变化,Occlusion Culling,遮挡剔除,迷雾层*

**标签:**<br/>
*等级: 中级|高级, 阶段: 开发, 分类: 研发能力, 角色: 客户端开发|美术*

## 图谱
![图片加载中...](../../exports/3.1.2.客户端3D场景开发.png?raw=true)

## 场景元素概览

### 地形

**做什么的？** 3D游戏场景的基础地形系统，包括地形网格生成、贴图处理和地形编辑。

**在哪用？** 所有需要地形的3D游戏场景，如开放世界、RPG、策略游戏等。

**会遇到哪些问题？**
- 如何生成和优化地形网格？
- 如何处理地形贴图，支持不同风格？
- 如何实现地形的自动生成或手动编辑？

**要点和思考方向：**

**地形网格：**
- **Height Map（高度图）：** 用贴图记录地形起伏，是地形生成的基础
- **法线计算：** 边角如果不想有接缝，需要对法线取平均值
- **LOD（细节层次）：** 优化内存和性能，根据距离调整地形细节
- **可见性：** 运行时只渲染玩家可见的面，限制同屏渲染面数

**贴图：**
- **Tiled Map（瓦片贴图）：** 适用于"复古"风格的地面，参考魔兽争霸的地图
- **Blend Map（混合贴图）：** 适用于"写实"风格的地面，参考魔兽世界的地图
- **Mipmap：** 优化内存和性能，让远处的画面自然，减少花点

**生成方法：**
- **绘制工具：** 制作地形编辑工具，让美术来制作地形
- **自动生成地形：** 可以用 Perlin noise 生成地形高度图，进而生成 Mesh

### 地图

**做什么的？** 游戏地图系统，特别是六边形地图的实现。

**在哪用？** 策略类游戏、回合制游戏等需要格子地图的场景。

**会遇到哪些问题？**
- 如何生成格子地图？
- 如何实现地图的视觉表现（颜色、高度）？
- 如何在地图上实现寻路？

**要点和思考方向：**
- **六边形地图：** 一些策略类游戏会选择这种地图
- 需要解决格子生成、颜色生成、高度生成、寻路等问题
- 参考：[A series about hexagon maps](https://catlikecoding.com/unity/tutorials/hex-map/)

### 植物

**做什么的？** 场景中植物的渲染和管理系统。

**在哪用？** 需要自然环境的3D游戏场景。

**会遇到哪些问题？**
- 如何确保渲染顺序正确，避免半透明物体互相遮盖错误？
- 如何优化植物的可见性？
- 如何实现植物的动画效果（如风中晃动）？
- 如何处理角色与植物交互的音效？

**要点和思考方向：**
- **渲染顺序：** 确保叶子跟其它（半透）特效互相遮盖的时候不要有错误
- **可见性：** 优化性能，只渲染可见的植物
- **动画：** 例如在风中的晃动效果
- **音效：** 角色踩上去的音效
- **候选工具：** SpeedTree - 专业的植物生成和渲染工具

### 云层

**做什么的？** 天空云层的生成和渲染系统。

**在哪用？** 需要天空表现的所有3D游戏场景。

**会遇到哪些问题？**
- 如何生成自然的云层贴图？

**要点和思考方向：**
- **生成云的贴图：** 可以用 Perlin noise 生成自然的云层效果

### 天空体

**做什么的？** 天空盒和天空渲染系统，处理天空的颜色和光照变化。

**在哪用？** 所有3D游戏场景的天空表现。

**会遇到哪些问题？**
- 如何实现天空体从低到高的颜色变化？
- 如何实现天空体随着时间变化产生的颜色变化？
- 如何处理渲染顺序和层级的问题？

**要点和思考方向：**
- 天空体从低到高的颜色变化（渐变效果）
- 天空体随着时间变化产生的颜色变化（昼夜变化）
- 要处理好渲染顺序和层级的问题，确保天空在正确的层级渲染

### 波浪

**做什么的？** 水面波浪的渲染和音效系统。

**在哪用？** 有水域的3D游戏场景。

**会遇到哪些问题？**
- 如何实现水面的动态渲染效果？
- 如何表现波光效果？
- 如何处理水面的音效？

**要点和思考方向：**
- **渲染：**
  - 水面的三角面变化（动态网格）
  - 贴图变化（流动效果）
  - 表现波光的 Shader
- **音效：**
  - 音源位置：海岸线跟摄像机的最近点

### 天气

**做什么的？** 游戏中的天气效果系统，包括雨雪、闪电等。

**在哪用？** 需要天气系统的3D游戏场景。

**会遇到哪些问题？**
- 如何实现雨雪效果？
- 如何实现闪电效果？
- 如何优化天气效果的性能？

**要点和思考方向：**

**雨雪：**
- **实现：**
  - 落地的效果或者落在其它物体上的效果
  - 在空中飘落的效果
- **范围：** 摄像机附近（性能优化）
- **音效：** 雨雪的声音效果

**闪电：**
- **光照：** 闪电时的光照效果
- **音效：** 雷声效果

### 时间（昼夜变化）

**做什么的？** 游戏中的时间系统，实现昼夜循环和光照变化。

**在哪用？** 需要时间系统的3D游戏场景。

**会遇到哪些问题？**
- 如何实现光照随时间的变化？
- 如何实现天空体随时间的变化？

**要点和思考方向：**
- **光照变化：** 太阳位置、光照强度、阴影方向等随时间变化
- **天空体变化：** 天空颜色、云层效果等随时间变化

### 室内场景

**做什么的？** 室内场景的渲染优化系统。

**在哪用？** 有室内场景的3D游戏。

**会遇到哪些问题？**
- 如何优化室内场景的渲染性能？
- 如何只渲染可见的物体？

**要点和思考方向：**
- **可见性：** Occlusion Culling（遮挡剔除）- 只渲染摄像机可见的物体，大幅提升性能

### 战争迷雾

**做什么的？** 策略游戏中用于隐藏未探索区域的迷雾系统。

**在哪用？** RTS、策略类游戏等。

**会遇到哪些问题？**
- 如何实现迷雾层的渲染？
- 如何根据探索状态更新迷雾？

**要点和思考方向：**
- **迷雾层：** 需要实现迷雾的渲染和更新机制
- 根据玩家的探索状态动态更新迷雾覆盖区域

## 更多资料
* [Using Perlin Noise to Create a Terrain Mesh](https://www.scratchapixel.com/lessons/procedural-generation-virtual-worlds/perlin-noise-part-2/perlin-noise-terrain-mesh)
* [A series about hexagon maps](https://catlikecoding.com/unity/tutorials/hex-map/)
