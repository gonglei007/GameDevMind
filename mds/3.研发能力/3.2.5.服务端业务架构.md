<h2 align="center">服务端业务架构</h2>
<p>
游戏产品的服务端是由大量的业务服务分工协作完成的，每个服务有不同的功能和角色。服务端业务架构需要考虑同服vs分服的选择，以及各种功能服务器的设计和实现。
</p>

**关键词:**<br/> 
*网关服,帐号服,游戏服,连接服,日志服,配置服,管理服,同服,分服*

**标签:**<br/>
*等级: 高级, 阶段: 开发, 分类: 研发能力, 角色: 服务端开发*

## 图谱

## 目录

- [架构概览](#架构概览)
- [同服vs分服](#同服vs分服)
- [网关服](#网关服)
- [配置服](#配置服)
- [帐号服/登录服](#帐号服登录服)
- [连接服](#连接服)
- [游戏服](#游戏服)
- [日志服](#日志服)
- [管理服](#管理服)
- [更多资料](#更多资料)

----

## 架构概览

## 同服vs分服

**是什么？在哪用？**

- **作用**：选择服务器架构模式
- **应用场景**：
  - 游戏项目初期架构设计
  - 服务器架构选型
  - 数据存储方案设计
- **做什么的？** 选择服务器架构模式。
- **在哪用？** 游戏项目初期架构设计。

**会遇到哪些问题？用什么解决？**

- **应该选择同服还是分服？**
  - **问题**：需要根据项目特点选择合适的架构模式
  - **解决方向**：
    - **同服：**
      - **特点：** 所有玩家在同一个数据库，数据库庞大，难以维护
      - **适用场景：**
        - 同时在线玩家更多，多地区玩家在线，需要实时响应
        - 玩家来自世界各地，必需很好的管理玩家接入体验
        - 玩家从不休息，很短的，甚至没有维护窗口
      - **优势：** 玩家可以跨服交互、数据统一管理
      - **劣势：** 数据库压力大、维护困难、扩展性差
    - **分服：**
      - **特点：** 每个游戏服有独立的玩家数据，数据库相对较小
      - **适用场景：**
        - 玩家数据进行了物理分离，同一个游戏服的在线人数相对较少
        - 引导玩家就近接入，玩家通常会有很好的接入体验
        - 游戏在线人数有高峰期和低谷期，可以在低谷期进行维护
      - **优势：** 数据库压力小、易于维护、扩展性好
      - **劣势：** 玩家无法跨服交互、数据分散

- **两种模式各有什么优缺点？**
  - **问题**：需要理解两种模式的优缺点
  - **解决方向**：
    - 分析游戏类型和玩家需求
    - 评估数据量和并发量
    - 考虑维护和扩展需求
    - 评估成本和技术难度
    - 选择匹配的架构模式

**要点和思考方向：**
- 同服适合需要跨服交互的游戏
- 分服适合独立运营的游戏
- 根据游戏类型和需求选择合适的架构
- 考虑数据量、并发量、维护成本等因素

## 网关服

**是什么？在哪用？**

- **作用**：客户端的统一入口和向导
- **应用场景**：
  - 所有需要接入客户端的服务端架构
  - 多服务器环境
  - 多渠道、多版本管理
- **做什么的？** 客户端的统一入口和向导。
- **在哪用？** 所有需要接入客户端的服务端架构。

**会遇到哪些问题？用什么解决？**

- **如何实现客户端统一入口？**
  - **问题**：需要为客户端提供统一的入口
  - **解决方向**：
    - **作用：**
      - **客户端统一入口：** 所有客户端请求首先到达网关服
        - 实现请求路由
        - 实现负载均衡
        - 实现请求过滤
      - **客户端的向导：** 引导客户端到合适的服务器
        - 根据渠道引导
        - 根据版本引导
        - 根据地区引导
    - 实现网关服务
    - 实现路由规则
    - 实现负载均衡

- **如何实现服务器引导？**
  - **问题**：需要根据条件引导客户端到不同服务器
  - **解决方向**：
    - **功能举例：** 将客户端根据渠道、版本等，引导到不同的服务器环境中
      - 实现渠道识别
      - 实现版本检查
      - 实现服务器选择
      - 实现动态路由
    - 实现服务器列表管理
    - 实现服务器状态监控
    - 实现智能路由

**要点和思考方向：**
- 网关服是客户端的第一道入口
- 实现智能路由提高用户体验
- 支持多渠道、多版本管理
- 实现负载均衡和故障转移

## 配置服

**是什么？在哪用？**

- **作用**：管理所有服务器的配置
- **应用场景**：
  - 需要集中管理配置的服务端架构
  - 多服务器环境
  - 配置热更新需求
- **做什么的？** 管理所有服务器的配置。
- **在哪用？** 需要集中管理配置的服务端架构。

**会遇到哪些问题？用什么解决？**

- **如何实现配置集中管理？**
  - **问题**：需要集中管理所有服务器的配置
  - **解决方向**：
    - **作用：**
      - **所有服务器从这里获取自己所需的配置：** 统一配置源
        - 实现配置存储
        - 实现配置分发
        - 实现配置版本管理
      - **管理各个服务器的配置：** 配置管理
        - 实现配置编辑
        - 实现配置审核
        - 实现配置发布
    - 实现配置中心
    - 实现配置API
    - 实现配置权限管理

- **如何实现配置服务？**
  - **问题**：需要选择合适的配置服务
  - **解决方向**：
    - **实现：**
      - **服务候选：** consul、nacos
        - **consul：** 服务发现和配置管理
          - 服务注册发现
          - 配置管理
          - 健康检查
        - **nacos：** 动态服务发现和配置管理
          - 服务注册发现
          - 配置管理
          - 动态配置
    - 实现配置热更新
    - 实现配置监听
    - 实现配置回滚

**要点和思考方向：**
- 配置服实现配置的集中管理
- 支持配置热更新提高灵活性
- 使用成熟的配置服务框架
- 实现配置版本管理和回滚

## 帐号服/登录服

**是什么？在哪用？**

- **作用**：处理用户登录和支付
- **应用场景**：
  - 所有需要用户认证和支付的游戏
  - 用户注册和登录
  - 支付处理
- **做什么的？** 处理用户登录和支付。
- **在哪用？** 所有需要用户认证和支付的游戏。

**会遇到哪些问题？用什么解决？**

- **如何实现用户登录？**
  - **问题**：需要实现用户认证和登录
  - **解决方向**：
    - **作用：**
      - **用户登录：** 处理用户认证
        - 实现多种登录方式（账号密码、第三方登录等）
        - 实现token管理
        - 实现会话管理
        - 实现安全验证
    - 实现用户数据库
    - 实现密码加密
    - 实现登录日志
    - 实现防刷机制

- **如何实现支付处理？**
  - **问题**：需要处理支付和发放游戏物资
  - **解决方向**：
    - **作用：**
      - **支付（支付后通知游戏服发放游戏物资）：** 处理支付流程
        - 对接支付平台
        - 处理支付回调
        - 验证支付结果
        - 通知游戏服发放物资
    - 实现支付订单管理
    - 实现支付回调处理
    - 实现物资发放
    - 实现支付日志

- **安全和防刷**
  - **问题**：需要防止账号和支付相关的安全问题
  - **解决方向**：
    - 实现防刷机制
    - 实现异常检测
    - 实现安全日志
    - 实现风险控制

**要点和思考方向：**
- 帐号服是用户认证和支付的核心服务
- 实现安全的登录和支付流程
- 支持多种登录方式和支付平台
- 实现完善的日志和监控

## 连接服

**是什么？在哪用？**

- **作用**：直接跟客户端相连，处理消息
- **应用场景**：
  - 需要长连接的游戏
  - 实时通信需求
  - 消息推送需求
- **做什么的？** 直接跟客户端相连，处理消息。
- **在哪用？** 需要长连接的游戏。

**会遇到哪些问题？用什么解决？**

- **如何管理客户端连接？**
  - **问题**：需要管理大量客户端连接
  - **解决方向**：
    - **作用：**
      - **直接跟客户端相连：** 维护客户端连接
        - 实现连接管理
        - 实现心跳检测
        - 实现断线重连
        - 实现连接池管理
    - 实现连接状态管理
    - 实现连接监控
    - 实现连接限流
    - 实现连接负载均衡

- **如何实现消息处理？**
  - **问题**：需要统一处理客户端消息
  - **解决方向**：
    - **作用：**
      - **对通过的消息进行统一的过滤和处理：** 消息处理
        - 实现消息路由
        - 实现消息过滤
        - 实现消息验证
        - 实现消息转发
    - 实现消息队列
    - 实现消息加密
    - 实现消息压缩
    - 实现消息监控

- **性能和扩展性**
  - **问题**：需要支持大量并发连接
  - **解决方向**：
    - 实现连接池
    - 实现异步处理
    - 实现负载均衡
    - 实现水平扩展

**要点和思考方向：**
- 连接服是客户端和服务端的桥梁
- 实现高效的连接管理和消息处理
- 支持大量并发连接
- 实现完善的监控和故障处理

## 游戏服

**是什么？在哪用？**

- **作用**：处理游戏逻辑
- **应用场景**：
  - 所有游戏的核心服务器
  - 游戏玩法实现
  - 玩家数据管理
- **做什么的？** 处理游戏逻辑。
- **在哪用？** 所有游戏的核心服务器。

**会遇到哪些问题？用什么解决？**

- **如何管理玩家角色？**
  - **问题**：需要管理玩家角色数据
  - **解决方向**：
    - **作用：**
      - **管理玩家角色：** 玩家数据管理
        - 实现角色创建
        - 实现角色数据存储
        - 实现角色数据同步
        - 实现角色数据缓存
    - 实现玩家数据库
    - 实现数据持久化
    - 实现数据缓存
    - 实现数据备份

- **如何实现游戏逻辑？**
  - **问题**：需要实现各种游戏玩法
  - **解决方向**：
    - **作用：**
      - **处理游戏逻辑：** 游戏玩法实现
        - 实现战斗系统
        - 实现任务系统
        - 实现社交系统
        - 实现经济系统
    - 实现模块化设计
    - 实现逻辑热更新
    - 实现逻辑测试
    - 实现逻辑监控

- **性能和扩展性**
  - **问题**：需要支持大量玩家和复杂逻辑
  - **解决方向**：
    - 实现逻辑优化
    - 实现数据分片
    - 实现负载均衡
    - 实现水平扩展

**要点和思考方向：**
- 游戏服是游戏的核心服务
- 实现模块化的游戏逻辑
- 优化性能和扩展性
- 实现完善的监控和日志

## 日志服

**是什么？在哪用？**

- **作用**：记录和分析游戏日志
- **应用场景**：
  - 需要日志记录和分析的系统
  - 问题排查
  - 数据分析
- **做什么的？** 记录和分析游戏日志。
- **在哪用？** 需要日志记录和分析的系统。

**会遇到哪些问题？用什么解决？**

- **如何处理大量的日志接收和处理？**
  - **问题**：需要处理大量日志数据
  - **解决方向**：
    - **作用：**
      - **记录各个服务器上报的日志：** 日志收集
        - 实现异步日志接收
        - 实现日志缓冲
        - 实现日志批量处理
        - 实现日志存储
      - **过后可以通过日志分析服务查询、分析游戏日志：** 日志分析
        - 实现日志搜索
        - 实现日志聚合
        - 实现日志统计
        - 实现日志可视化
    - **解决问题：**
      - **大量的日志接收和处理：**
        - 使用消息队列缓冲
        - 实现批量处理
        - 使用分布式存储
        - 实现日志压缩
    - 使用日志收集框架（如ELK）
    - 实现日志分片存储
    - 实现日志索引

- **如何不阻塞其它业务？**
  - **问题**：日志处理不能影响业务性能
  - **解决方向**：
    - **解决问题：**
      - **不能阻塞其它业务：**
        - 实现异步日志上报
        - 实现日志队列
        - 实现日志限流
        - 实现日志降级
    - 使用异步IO
    - 实现日志优先级
    - 实现日志采样
    - 实现日志过滤

- **日志服务选择**
  - **问题**：需要选择合适的日志服务
  - **解决方向**：
    - **扩展信息：** 现在有一些第三方服务，实现了优质的数据收集服务
      - 使用第三方日志服务（如阿里云日志服务、腾讯云CLS等）
      - 使用开源日志框架（如ELK、Loki等）
      - 实现自建日志系统
    - 评估日志服务功能
    - 评估日志服务性能
    - 评估日志服务成本

**要点和思考方向：**
- 日志服是问题排查和数据分析的基础
- 实现异步日志处理避免阻塞业务
- 使用成熟的日志收集和分析框架
- 实现日志的快速查询和分析

## 管理服

**是什么？在哪用？**

- **作用**：监控并管理各个服务器
- **应用场景**：
  - 需要服务器管理的系统
  - 服务器监控
  - 服务器运维
- **做什么的？** 监控并管理各个服务器。
- **在哪用？** 需要服务器管理的系统。

**会遇到哪些问题？用什么解决？**

- **如何实现服务器监控？**
  - **问题**：需要监控各个服务器的状态
  - **解决方向**：
    - **作用：** 监控并管理各个服务器
      - 实现服务器状态监控
      - 实现性能监控
      - 实现告警机制
      - 实现监控面板
    - 使用监控工具（如Prometheus、Grafana等）
    - 实现自定义监控指标
    - 实现监控告警
    - 实现监控数据存储

- **如何实现服务器管理？**
  - **问题**：需要管理各个服务器的操作
  - **解决方向**：
    - **功能举例：**
      - **控制各个服务器：** 服务器控制
        - 实现服务器启动/停止
        - 实现服务器重启
        - 实现服务器配置更新
        - 实现服务器操作审批
      - **动态扩容：** 服务器扩展
        - 实现自动扩容
        - 实现手动扩容
        - 实现资源管理
        - 实现成本控制
      - **查看状态：** 状态查询
        - 实现实时状态查询
        - 实现历史状态查询
        - 实现状态统计
        - 实现状态可视化
    - 实现服务器管理API
    - 实现操作日志
    - 实现权限控制
    - 实现操作审计

- **自动化和智能化**
  - **问题**：需要实现自动化运维
  - **解决方向**：
    - 实现自动化部署
    - 实现自动化扩容
    - 实现智能告警
    - 实现故障自愈

**要点和思考方向：**
- 管理服是服务器运维的核心工具
- 实现完善的监控和管理功能
- 支持自动化和智能化运维
- 实现权限控制和操作审计

## 更多资料
