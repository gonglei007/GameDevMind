<h2 align="center">服务端业务架构</h2>
<p>
游戏产品的服务端是由大量的业务服务分工协作完成的，每个服务有不同的功能和角色。服务端业务架构需要考虑同服vs分服的选择，以及各种功能服务器的设计和实现。
</p>

**关键词:**<br/> 
*网关服,帐号服,游戏服,连接服,日志服,配置服,管理服,同服,分服*

**标签:**<br/>
*等级: 高级, 阶段: 开发, 分类: 研发能力, 角色: 服务端开发*

## 图谱
![图片加载中...](../../exports/3.2.5.服务端业务架构.png?raw=true)

## 架构概览

### 同服vs分服

**做什么的？** 选择服务器架构模式。

**在哪用？** 游戏项目初期架构设计。

**会遇到哪些问题？**
- 应该选择同服还是分服？
- 两种模式各有什么优缺点？

**要点和思考方向：**

**同服：**
- 所有玩家在同一个数据库，数据库庞大，难以维护
- 同时在线玩家更多，多地区玩家在线，需要实时响应
- 玩家来自世界各地，必需很好的管理玩家接入体验
- 玩家从不休息，很短的，甚至没有维护窗口

**分服：**
- 每个游戏服有独立的玩家数据，数据库相对较小
- 玩家数据进行了物理分离，同一个游戏服的在线人数相对较少
- 引导玩家就近接入，玩家通常会有很好的接入体验
- 游戏在线人数有高峰期和低谷期，可以在低谷期进行维护

### 网关服

**做什么的？** 客户端的统一入口和向导。

**在哪用？** 所有需要接入客户端的服务端架构。

**要点和思考方向：**
- **作用：**
  - 客户端统一入口
  - 客户端的向导
- **功能举例：** 将客户端根据渠道、版本等，引导到不同的服务器环境中

### 配置服

**做什么的？** 管理所有服务器的配置。

**在哪用？** 需要集中管理配置的服务端架构。

**要点和思考方向：**
- **作用：**
  - 所有服务器从这里获取自己所需的配置
  - 管理各个服务器的配置
- **实现：**
  - **服务候选：** consul、nacos

### 帐号服/登录服

**做什么的？** 处理用户登录和支付。

**在哪用？** 所有需要用户认证和支付的游戏。

**要点和思考方向：**
- **作用：**
  - 用户登录
  - 支付（支付后通知游戏服发放游戏物资）

### 连接服

**做什么的？** 直接跟客户端相连，处理消息。

**在哪用？** 需要长连接的游戏。

**要点和思考方向：**
- **作用：**
  - 直接跟客户端相连
  - 对通过的消息进行统一的过滤和处理

### 游戏服

**做什么的？** 处理游戏逻辑。

**在哪用？** 所有游戏的核心服务器。

**要点和思考方向：**
- **作用：**
  - 管理玩家角色
  - 处理游戏逻辑

### 日志服

**做什么的？** 记录和分析游戏日志。

**在哪用？** 需要日志记录和分析的系统。

**会遇到哪些问题？**
- 如何处理大量的日志接收和处理？
- 如何不阻塞其它业务？

**要点和思考方向：**
- **作用：**
  - 记录各个服务器上报的日志
  - 过后可以通过日志分析服务查询、分析游戏日志
- **解决问题：**
  - 大量的日志接收和处理
  - 不能阻塞其它业务
- **扩展信息：** 现在有一些第三方服务，实现了优质的数据收集服务

### 管理服

**做什么的？** 监控并管理各个服务器。

**在哪用？** 需要服务器管理的系统。

**要点和思考方向：**
- **作用：** 监控并管理各个服务器
- **功能举例：**
  - 控制各个服务器
  - 动态扩容
  - 查看状态

## 更多资料
