<h2 align="center">网游网络同步</h2>
<p>
网络游戏中，玩家之间需要同步信息（数据/状态），不同的游戏类型对信息同步的要求也不相同。你的产品需要哪些同步上的考量？在多人游戏中，每个玩家都会看到自己的游戏画面，但其他玩家的游戏画面可能会与自己的有所不同，这是因为网络延迟和带宽限制等因素的影响。为了保持游戏的一致性，需要进行同步，使每个玩家都看到相同的游戏状态和行为。
</p>

**关键词:**<br/>
*AOI,状态同步,帧同步，混合同步,插值,预测,校正*

**标签:**<br/>
*等级: 高级, 阶段: 开发, 分类: 研发能力, 角色: 服务端开发|客户端开发*

## 图谱
![图片加载中...](../../exports/3.2.2.网游网络同步.png?raw=true)

## 同步概览

### 说明

**做什么的？** 在多人游戏中保持游戏状态的一致性。

**在哪用？** 所有多人网络游戏。

**会遇到哪些问题？**
- 如何保持多个玩家看到的游戏状态一致？
- 如何处理网络延迟和带宽限制？

**要点和思考方向：**
- 在多人游戏中，每个玩家都会看到自己的游戏画面，但其他玩家的游戏画面可能会与自己的有所不同，这是因为网络延迟和带宽限制等因素的影响
- 为了保持游戏的一致性，需要进行同步，使每个玩家都看到相同的游戏状态和行为

### 同步方式

**做什么的？** 选择适合游戏类型的同步方式。

**在哪用？** 根据游戏类型选择合适的同步方案。

**会遇到哪些问题？**
- 什么时候用状态同步，什么时候用帧同步？
- 两种同步方式有什么区别？

**要点和思考方向：**

**状态同步：**
- **说明：** 发指令，收状态。客户端发送指令给服务器，服务器处理后返回结果（状态）
- **基于对等网络：** 每个客户端都保存着完整的游戏状态，并通过网络将状态同步到其他客户端。这种同步方式可以减少服务器负担，但需要处理玩家之间的冲突和延迟问题
- **应用场景：** 实时性不高的游戏，比如SLG

**帧同步：**
- **说明：** 发操作，收操作
- **基于服务器：** 将游戏状态保存在游戏服务器上，并在每个客户端之间进行通信以更新状态。客户端会将自己的行为发送到服务器，服务器会验证并更新游戏状态，然后将新状态发送回每个客户端。这种同步方式可以保证游戏状态的一致性，但也会增加网络延迟和服务器负担
- **特点：**
  - 传输数据少
  - 操作响应快
- **保障：**
  - **网络稳定性：** UDP、断线重连
  - **作弊问题：** 需要防止客户端作弊
- **应用场景：** 实时性较高的游戏，比如RTS、FPS

### 同步技术

**做什么的？** 优化同步效果的技术手段。

**在哪用？** 所有网络同步系统。

**要点和思考方向：**
- **插值：** 平滑游戏状态的变化
- **预测：** 减少延迟，客户端预测服务器状态
- **校正：** 修正由于网络延迟引起的游戏状态偏差

### 同步内容

**做什么的？** 确定需要同步的游戏内容。

**在哪用？** 设计同步系统时。

**要点和思考方向：**
- **物理：** 位置、旋转、速度
- **动画：** 角色动画状态
- **特效：** 技能特效、粒子效果
- **碰撞：** 碰撞检测结果

### AOI（Area of Interest，兴趣区域）

**做什么的？** 管理玩家之间的可见性和交互性的空间管理算法。

**在哪用？** 大型多人在线游戏。

**会遇到哪些问题？**
- 当大量用户同时在线，如何避免信息量"大爆炸"？
- 如何控制信息的同步范围？

**要点和思考方向：**
- **说明：** Area of Interest，兴趣区域。是一种用于多人在线游戏开发的空间管理算法，用于管理玩家之间的可见性和交互性
- **方法：** 将游戏世界划分为若干个空间区域，每个区域称为一个兴趣区域（Interest Area），每个玩家位于一个或多个兴趣区域中。当玩家进入或离开一个兴趣区域时，系统会触发事件通知其他与该区域相交的玩家，从而保证玩家之间的可见性和交互性
- **解决问题：** 当大量用户同时在线，并且可以互相看到和互动。就需要有一个方案，在避免传递信息量"大爆炸"的前提下，来控制信息的同步
- **算法：**
  - 灯塔法
  - 九宫格
  - 十字链表法
- **应用举例：**
  - 玩家交互
  - 动态对象的移动
  - NPC的行为

## 更多资料
* [Game server AOI implementation](https://programmerall.com/article/24132060302/)
* [帧同步：原理与实现](https://zhuanlan.zhihu.com/p/556920018?utm_campaign=&utm_medium=social&utm_oi=27483965489152&utm_psn=1545491230850514944&utm_source=qq) - 本文的主题是网络游戏帧同步技术详解，会用深入浅出的方式来为大家介绍帧同步的原理，以及如何实现