<h2 align="center">游戏数据文件</h2>
<p>
游戏开发中涉及各种格式文件的读写，有些数据是内容工具方定义的，有些数据是大家常用的标准格式，有些数据是游戏中自定义的。不同的数据对结构化、解析、存取速度等的需求不同。本章节更关注「如何为不同用途选对数据格式和处理方式」，而不是教具体文件规格。
</p>

**关键词:**<br/>
*序列化,Blob,配置数据,资源格式,版本兼容*

**标签:**<br/>
*等级: 中级, 阶段: 开发, 分类: 生产能力, 角色: 客户端开发|服务端开发*

## 图谱
![图片加载中...](../../exports/4.2.3.游戏数据文件.png?raw=true)

## 数字资源数据

### 3D 建模数据

**做什么的？**  
描述 3D 模型在引擎中的几何与材质信息。

**数据内容：**
- 网格数据：
  - 顶点位置
  - 法线
  - 顶点色
  - UV
  - 骨骼权重
  - 三角面索引
- 材质数据：
  - 材质属性（颜色、金属度、粗糙度等）
- 对象数据：
  - 平滑组  
    - 对三角面进行分组，在同一组的三角面上法线做平滑（相邻面的法线取平均）  
    - 平滑组数据通常仅存在于编辑环境；导出到游戏使用的数据，一般已经根据平滑组计算好每个顶点/面的法线

**编辑期数据格式：**
- **fbx：**
  - 最常用的建模数据格式，二进制存储，可包含多种建模数据  
  - 可兼容多种 DCC 编辑器
- **collada：**
  - 一种 XML 格式的建模数据文件
- **ma / max：**
  - Maya / 3ds Max 编辑器的源文件格式

### 图片数据

**做什么的？**  
为模型、UI、特效等提供纹理与贴图。

**常见格式：**
- TGA – 32 位，有 8 位 Alpha 通道  
- PNG – 压缩格式，有透明色  
- JPG – 压缩格式，无半透明  
- DXT – 多种 GPU 友好压缩格式

**应用要点：**
- 有损 vs 无损、有压缩 vs 无压缩、有 Alpha vs 无 Alpha、像素位数  
- 例如：用于记录高度场信息的贴图，一般不适合用有损压缩格式

### 声音数据

**做什么的？**  
为游戏提供音效与背景音乐。

**常见格式：**
- **WAV：** 无压缩音频格式，音质好，体积较大  
- **OGG：** 开源免费的有损压缩音频格式  
- **MP3：** 常见有损压缩音频格式（注意部分平台上的授权与专利问题）

**应用要点：**
- 不同设备、不同类型音频（BGM、语音、短音效）适合不同格式和码率

## 数据处理

### 数据序列化

**概念：**  
将数据结构或对象状态转换为可以存储（文件或内存缓冲区）或传输（网络）的形式，并在以后重建（可能在不同的计算机环境中）。

**作用：**
- 提高数据加载速度：加载后可以直接使用，不必再进行复杂解析与初始化
- 更优化的数据空间占用

### Blob（Binary Large Object）

**做什么的？**  
作为大数据对象，用于存储各类对象的数据块。

**特性：**
- 加载数据后是连续的内存分布
- 数据结构在内存中的直接映射（结构体布局与文件布局一致）

**读流程：**
- 序列化（Serializing）：从 Blob 转换成编辑 / 运行时数据
- 分配（Allocating）：从 Blob 直接加载到内存

**写流程：**
- 序列化（Serializing）：从编辑 / 运行时数据转换成 Blob
- 分配（Allocating）：从内存直接存入 Blob

### 数据版本

**做什么的？**  
保证数据结构升级时仍能兼容旧版本。

**要点：**
- 在二进制格式中加入版本号与兼容处理逻辑
- 对新增字段采用默认值策略，避免旧数据崩溃

## 配置类数据

### Excel

**作用：**  
策划配表的主战场，方便、灵活、高效地编辑配置数据。

**编辑期数据：**
- 游戏工程通常不会直接使用 Excel 作为运行时配置数据  
- 一般会导出为 JSON、XML、YAML 或自定义二进制格式再在游戏中使用

### XML

**特点：**
- 结构表达清晰且层级明确

**应用：**
- 游戏配置数据
- 网络参数和数据传递

### JSON

**特点：**
- 相对 XML 数据更小
- 结构表达也不错
- JS 语言原生支持（无需解析库）
- 不支持注释

**应用：**
- 游戏配置数据
- 网络参数和数据传递

### YAML

**特点：**
- JSON 的超集
- 更精简，更易读

**应用：**
- 游戏配置数据（尤其是需要人手编辑的配置）

## 其它数据

### UI 数据

**举例：**
- 布局信息：适合用 XML / JSON / 自定义格式来描述
- 与引擎 UI 系统结合（组件树、样式、绑定关系等）

## 更多资料
* [Serialization For Games](https://jorenjoestar.github.io/post/serialization_for_games/)