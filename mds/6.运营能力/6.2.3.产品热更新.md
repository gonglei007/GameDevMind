<h2 align="center">产品热更新</h2>
<p>跟热更新相关的技术和应用。</p>

**关键词:**<br/> 
*热更新,hotfix,lua,CDN*

**标签:**<br/>
*等级: 中级, 阶段: 开发|运营, 分类: 运营能力, 角色: 客户端开发|服务端开发|运维*

## 图谱

## 目录

- [为什么需要热更新？](#为什么需要热更新)
- [热更新系统需要具备的功能](#热更新系统需要具备的功能)
- [客户端方案](#客户端方案)
- [服务端方案](#服务端方案)
- [数据生产方案](#数据生产方案)
- [数据发布方案](#数据发布方案)
- [管理后台方案](#管理后台方案)
- [版本管理](#版本管理)
- [热更发布流程](#热更发布流程)
- [大版本发布](#大版本发布)

----

## 为什么需要热更新？

**是什么？在哪用？**

- **作用**：在不重新发布应用包的情况下，动态更新游戏内容、功能和数据
- **应用场景**：
  - 内容和功能的更新
  - 调整策划数据
  - 修复产品bug
  - 快速响应运营需求
- **运营需求**：
  - 数据表热更
  - 资源+代码热更

**会遇到哪些问题？用什么解决？**

- **如何应对快速变化的需求？**
  - **问题**：网游产品的一大要求——能应对快速变化：策划不停更新游戏内容（活动礼包等等）
  - **解决方向**：
    - **快速更新需求：** 更新需求
      - **每次针对修改去定制，耗时耗力：** 定制问题
        - 每次修改需要定制
        - 耗时耗力
      - **每次出版本更新，对于网游运营应对太慢：** 版本更新慢
        - 版本更新流程慢
        - 无法快速响应
    - **热更新解决方案：** 热更方案
      - 使用热更新快速响应需求
      - 避免频繁发版
      - 提升运营效率
    - 使用热更新快速响应需求
    - 避免频繁发版导致的用户流失
    - 提升运营效率

- **如何避免用户流失？**
  - **问题**：频繁发版可能导致用户流失
  - **解决方向**：
    - **用户流失问题：** 流失问题
      - 频繁发版导致用户流失
      - 下载安装新包造成流失
    - **热更新解决方案：** 热更方案
      - 通过热更避免用户流失
      - 游戏用户不用下载安装新包
      - 提升用户体验
    - 通过热更避免用户流失
    - 游戏用户不用下载安装新包
    - 提升用户体验

**要点和思考方向：**
- 热更新是网游产品快速迭代的基础能力
- 可以避免频繁发版导致的用户流失
- 需要支持差异化更新，不同渠道、版本可能需要不同的热更内容
- 热更新可以快速响应运营需求，提升运营效率
- 避免频繁发版，减少用户流失
- 支持差异化更新，满足不同渠道和版本的需求

## 热更新系统需要具备的功能

**是什么？在哪用？**

- **作用**：提供完整的热更新功能，支持快速制作、发布和管理热更新
- **应用场景**：
  - 热更新数据制作
  - 热更新版本发布
  - 热更新版本管理
  - 热更新版本回滚
- **核心功能**：
  - **要能差异化更新**：支持不同渠道、版本的热更内容
  - **要能快速的制作和发布**：提升运营效率
  - **游戏用户不用下载安装新包，造成流失**：通过热更避免用户流失
  - **一键生成可热更数据**：简化数据制作流程
  - **一键发布数据**：
    - 自动上传、预热
  - **可快速切换版本**：支持版本回滚
  - **版本管理**：
    - 坐标：环境、平台、分支等

**会遇到哪些问题？用什么解决？**

- **如何实现差异化更新？**
  - **问题**：需要支持不同渠道、版本的热更内容
  - **解决方向**：
    - **差异化更新：** 差异更新
      - **要能差异化更新：支持不同渠道、版本的热更内容：** 差异支持
        - 支持不同渠道
        - 支持不同版本
        - 支持不同热更内容
    - 支持不同渠道、版本的热更内容
    - 实现差异化更新机制
    - 满足不同渠道和版本的需求

- **如何提升制作和发布效率？**
  - **问题**：需要快速制作和发布热更新
  - **解决方向**：
    - **快速制作和发布：** 效率提升
      - **要能快速的制作和发布：提升运营效率：** 快速制作
        - 快速制作热更数据
        - 快速发布热更版本
        - 提升运营效率
      - **一键生成可热更数据：简化数据制作流程：** 一键生成
        - 一键生成可热更数据
        - 简化数据制作流程
      - **一键发布数据：自动上传、预热：** 一键发布
        - 一键发布数据
        - 自动上传
        - 自动预热
    - 实现一键生成可热更数据
    - 实现一键发布数据，自动上传和预热
    - 提升运营效率

- **如何实现版本管理？**
  - **问题**：需要管理多个版本和分支
  - **解决方向**：
    - **版本管理：** 版本控制
      - **版本管理：坐标：环境、平台、分支等：** 版本坐标
        - 环境维度
        - 平台维度
        - 分支维度
      - **可快速切换版本：支持版本回滚：** 版本切换
        - 快速切换版本
        - 支持版本回滚
    - 实现多维度版本管理（环境、平台、分支）
    - 支持快速切换版本和回滚
    - 应对线上问题

**要点和思考方向：**
- 热更新系统要易用，降低运营成本
- 版本管理要灵活，支持多环境、多平台、多分支
- 需要支持快速回滚，应对线上问题
- 实现一键生成和发布，提升运营效率
- 支持差异化更新，满足不同渠道和版本的需求
- 实现完善的版本管理机制，支持快速切换和回滚

## 客户端方案

**是什么？在哪用？**

- **作用**：在客户端实现热更新功能，支持动态加载资源和代码
- **应用场景**：
  - 游戏客户端需要支持热更新
  - 资源动态加载
  - 代码动态更新

**会遇到哪些问题？用什么解决？**

- **如何实现代码热更新？**
  - **问题**：原生代码无法热更新
  - **解决方向**：
    - **代码/脚本数据化方案：** 代码热更
      - **问题：原生代码无法热更新：** 原生代码限制
        - 原生代码无法热更新
        - 需要重新编译发布
      - **解决方案：** 热更方案
        - **Lua：使用脚本语言实现热更新：** Lua方案
          - **候选：tolua、xlua：** Lua框架
            - tolua
            - xlua
          - 使用脚本语言实现热更新
        - **C#脚本：预先插入注入代码：** C#脚本
          - 预先插入注入代码
        - **C#：使用ILRuntime或HybridCLR实现C#热更新：** C#热更
          - **候选：HybridCLR、ILRuntime：** C#热更框架
            - HybridCLR
            - ILRuntime
          - 使用ILRuntime或HybridCLR实现C#热更新
    - 使用脚本语言（Lua）实现热更新
    - 使用ILRuntime或HybridCLR实现C#热更新
    - 根据项目需求选择合适的方案

- **如何实现资源更新？**
  - **问题**：需要实现资源动态更新
  - **解决方向**：
    - **客户端运行时系统功能：** 运行时功能
      - **指向更新后台：** 更新后台
        - 指向更新后台
      - **检查版本：** 版本检查
        - 检查版本
      - **获取资源清单：** 资源清单
        - 获取资源清单
      - **比较资源hash值：** 资源比较
        - 比较资源hash值
        - 识别变化资源
      - **同步/下载变化的资源：** 资源下载
        - **注意：不能直接下载覆盖原来的文件：** 下载注意
          - 不能直接覆盖
          - 需要安全更新机制
        - 同步/下载变化的资源
      - **更新时机：** 更新时机
        - **启动时检查更新：** 启动更新
          - 启动时检查更新
        - **后台静默更新：** 静默更新
          - 后台静默更新
    - 实现版本检查和资源清单获取
    - 比较资源hash值，识别变化资源
    - 安全下载和更新资源，不能直接覆盖
    - 合理选择更新时机

- **如何处理网络异常？**
  - **问题**：网络下载可能出现异常
  - **解决方向**：
    - **关联系统：** 系统依赖
      - **依赖系统：** 依赖系统
        - **HTTP网络系统（多线程并行下载）：** 网络系统
          - HTTP网络系统
          - 多线程并行下载
        - **考虑问题：网络下载异常处理：** 异常处理
          - 网络下载异常处理
          - 断点续传
          - 重试机制
      - **对接系统：** 对接系统
        - **UI系统：** UI系统
        - **元数据系统：** 元数据系统
        - **Lua系统或者其它动态脚本系统：** 脚本系统
    - 使用HTTP网络系统，支持多线程并行下载
    - 实现网络下载异常处理、断点续传、重试机制
    - 对接UI系统、元数据系统、脚本系统

**要点和思考方向：**
- 客户端热更新需要支持资源更新和代码更新
- 脚本语言（如Lua）是常见的代码热更新方案
- 资源更新要支持差异更新，避免下载完整资源包
- 需要考虑网络异常、下载失败等异常情况
- 更新时机要合理，避免影响用户体验
- 选择合适的代码热更新方案（Lua、ILRuntime、HybridCLR等）
- 实现完善的资源更新机制，支持差异更新
- 处理网络异常，实现断点续传和重试机制

## 服务端方案

**是什么？在哪用？**

- **作用**：服务端热更新配置数据，支持动态调整游戏配置
- **应用场景**：
  - 服务端需要支持配置数据热更新
  - 游戏配置动态调整
  - 不停服更新配置

**会遇到哪些问题？用什么解决？**

- **如何实现配置数据热更新？**
  - **问题**：需要实现服务端配置数据热更新
  - **解决方向**：
    - **服务端热更新：** 热更机制
      - **说明：服务端通常不需要跟客户端共用艺术数据和代码，但通常会共用配置数据：** 数据特点
        - 服务端和客户端共用配置数据
        - 不需要共用艺术数据和代码
      - **服务端运行时系统功能：由于服务端跟客户端使用数据的特性不同，服务端可以选择（配置）数据包整体下载、释放：** 数据下载
        - 数据包整体下载
        - 数据包释放
        - 适合服务端数据特性
    - 实现配置数据包整体下载和释放
    - 根据服务端数据特性选择合适的更新方式
    - 确保配置数据更新成功

- **如何保证数据一致性？**
  - **问题**：数据更新后需要保证内存数据一致性
  - **解决方向**：
    - **数据一致性：** 一致性保证
      - **考虑问题：数据更新后，内存中的元数据（被使用和引用的）和由元数据衍生出来的数据需要更新：** 内存更新
        - 内存中的元数据需要更新
        - 被使用和引用的数据需要更新
        - 由元数据衍生出来的数据需要更新
    - 数据更新后，同步更新内存中的元数据
    - 更新被使用和引用的数据
    - 更新由元数据衍生出来的数据
    - 保证数据一致性

**要点和思考方向：**
- 服务端热更新主要是配置数据更新
- 需要考虑数据更新后内存数据的同步更新
- 服务端数据更新要保证数据一致性
- 根据服务端数据特性选择合适的更新方式
- 数据更新后同步更新内存数据，保证一致性
- 确保配置数据更新的安全性和可靠性

## 数据生产方案

**是什么？在哪用？**

- **作用**：将策划、美术、程序的数据转换为游戏中可使用的格式
- **应用场景**：
  - 热更新数据制作流程
  - 数据格式转换
  - 数据打包处理

**会遇到哪些问题？用什么解决？**

- **如何处理配置数据？**
  - **问题**：需要处理策划的配置数据
  - **解决方向**：
    - **配置数据（策划）：** 配置处理
      - **生成在游戏中可使用的配置数据：** 数据生成
        - 生成可使用的配置数据
      - **处理：Excel转json、xml等：** 格式转换
        - Excel转json
        - Excel转xml
        - 数据格式转换
    - 生成在游戏中可使用的配置数据
    - 实现Excel转json、xml等格式转换
    - 自动化处理流程

- **如何处理艺术和场景数据？**
  - **问题**：需要处理美术的艺术和场景数据
  - **解决方向**：
    - **艺术和场景数据（美术）：** 美术数据处理
      - **可在游戏中加载使用：** 数据可用
        - 可在游戏中加载使用
      - **处理：直接生成bundle：** Bundle生成
        - 直接生成bundle
        - 资源打包
    - 处理艺术和场景数据，使其可在游戏中加载使用
    - 直接生成bundle，实现资源打包

- **如何处理代码数据？**
  - **问题**：需要处理程序的代码数据
  - **解决方向**：
    - **代码数据（程序）：** 代码处理
      - **处理：脚本编码加固（可选）：** 代码加固
        - 脚本编码加固
        - 保护知识产权
        - 可选处理
    - 处理代码数据，支持脚本编码加固
    - 保护知识产权
    - 根据需求选择是否加固

- **如何实现自动化生产？**
  - **问题**：需要实现数据生产自动化
  - **解决方向**：
    - **自动化生产：** 自动化机制
      - **数据生产要自动化，支持一键生成：** 一键生成
        - 自动化数据生产
        - 支持一键生成
        - 提升生产效率
    - 实现数据生产自动化
    - 支持一键生成可热更数据
    - 提升生产效率

**要点和思考方向：**
- 数据生产要自动化，支持一键生成
- 不同来源的数据需要不同的处理方式
- 代码数据可以考虑加密加固，保护知识产权
- 实现自动化数据生产流程，支持一键生成
- 不同来源的数据采用不同的处理方式
- 代码数据可选加密加固，保护知识产权

## 数据发布方案

**是什么？在哪用？**

- **作用**：将热更新数据发布到CDN，供客户端下载
- **应用场景**：
  - 热更新数据发布流程
  - 数据上传和分发
  - CDN数据管理

**会遇到哪些问题？用什么解决？**

- **如何选择数据更新方式？**
  - **问题**：需要选择合适的数据更新方式
  - **解决方向**：
    - **数据更新方式：** 更新方式
      - **增量包更新：过去端游用的多些：** 增量更新
        - 增量包更新
        - 过去端游常用
      - **差异更新：这是我们所采用的（只更新变化的部分）：** 差异更新
        - 只更新变化的部分
        - 减少下载量
        - 提升更新速度
    - 根据项目需求选择合适的更新方式
    - 差异更新可以大大减少下载量
    - 提升更新速度

- **如何加速数据下载？**
  - **问题**：需要加速数据下载，提升用户体验
  - **解决方向**：
    - **数据加速：** 加速方案
      - **用CDN对数据加速：** CDN加速
        - 使用CDN加速
        - 提升下载速度
        - 改善用户体验
      - **刷新预热：新上传的数据要预热，更新的文件要刷新：** 预热刷新
        - 新上传的数据要预热
        - 更新的文件要刷新
        - 确保用户获取最新数据
    - 使用CDN对数据加速
    - 新上传的数据要预热，更新的文件要刷新
    - 确保用户能获取到最新数据

**要点和思考方向：**
- 差异更新可以大大减少下载量，提升更新速度
- CDN加速可以提升下载速度，改善用户体验
- 需要支持预热和刷新，确保用户能获取到最新数据
- 选择合适的更新方式（增量更新或差异更新）
- 使用CDN加速，提升下载速度
- 实现预热和刷新机制，确保数据及时更新

## 管理后台方案

**是什么？在哪用？**

- **作用**：管理热更新版本，支持版本发布和回滚
- **应用场景**：
  - 热更新版本管理
  - 版本发布和回滚
  - 热更新配置管理

**会遇到哪些问题？用什么解决？**

- **如何发布版本？**
  - **问题**：需要发布新的热更新版本
  - **解决方向**：
    - **版本发布：** 发布功能
      - **版本发布：发布新的热更新版本：** 发布机制
        - 发布新的热更新版本
        - 版本发布流程
    - 实现版本发布功能
    - 支持快速发布新版本
    - 确保发布流程的可靠性

- **如何实现版本回滚？**
  - **问题**：如果发现一个版本有问题，需要能回退到之前的版本
  - **解决方向**：
    - **版本回滚：** 回滚功能
      - **解决问题：如果发现一个版本有问题，要能回退到之前的版本：** 回滚需求
        - 版本有问题时需要回滚
        - 回退到之前的版本
        - 快速恢复服务
    - 实现版本回滚功能
    - 支持快速回退到之前的版本
    - 应对线上问题

- **如何配置热更新参数？**
  - **问题**：需要配置热更新相关参数
  - **解决方向**：
    - **配置：配置热更新相关参数：** 配置功能
      - 配置热更新相关参数
      - 环境、平台、分支等配置
      - 版本管理配置
    - 实现配置功能
    - 支持环境、平台、分支等配置
    - 灵活管理版本配置

**要点和思考方向：**
- 管理后台要简单易用，支持快速发布和回滚
- 版本回滚是重要的安全机制，必须支持
- 需要支持版本配置，如环境、平台、分支等
- 实现简单易用的管理后台
- 支持快速发布和回滚，应对线上问题
- 支持灵活的版本配置，满足不同需求

## 版本管理

**是什么？在哪用？**

- **作用**：管理热更新版本和分支，支持多维度版本控制
- **应用场景**：
  - 热更新版本管理
  - 版本和分支规划
  - 多渠道版本管理

**会遇到哪些问题？用什么解决？**

- **如何规划版本和分支？**
  - **问题**：上线的产品可能版本众多，要能够有效的规划版本和分支
  - **解决方向**：
    - **版本规划：** 规划方案
      - **维度：** 版本维度
        - **版本：** 版本维度
          - 版本维度
        - **渠道：** 渠道维度
          - 渠道维度
      - **分支：** 分支管理
        - **可以为渠道创建版本控制分支，内容一致的渠道在一个分支上：** 渠道分支
          - 为渠道创建分支
          - 内容一致的渠道在一个分支
        - **设定分热修复分支，用于日常快速修复线上问题：** 热修复分支
          - 热修复分支
          - 快速修复线上问题
        - **分支合并：在热更分支修复，合并回开发分支：** 分支合并
          - 在热更分支修复
          - 合并回开发分支
          - 保持代码一致性
    - 支持多维度版本管理（版本、渠道）
    - 为渠道创建版本控制分支
    - 设定热修复分支，快速修复线上问题
    - 实现分支合并，保持代码一致性

**要点和思考方向：**
- 版本管理要支持多维度（版本、渠道、分支）
- 热修复分支可以快速修复线上问题，不影响主分支
- 分支合并要保持代码一致性
- 支持多维度版本管理，灵活规划版本和分支
- 使用热修复分支快速修复线上问题
- 实现分支合并，保持代码一致性

## 热更发布流程

**是什么？在哪用？**

- **作用**：规范热更新发布流程，确保发布质量
- **应用场景**：
  - 日常热更新发布
  - 热更新版本发布
  - 热更新质量保证

**会遇到哪些问题？用什么解决？**

- **如何规范发布流程？**
  - **问题**：需要规范热更新发布流程，确保发布质量
  - **解决方向**：
    - **发布流程：** 流程规范
      - **1. 准备：准备热更测试环境：** 准备阶段
        - 准备热更测试环境
        - 环境准备
      - **2. 制作：制作热更数据：** 制作阶段
        - 制作热更数据
        - 数据生产
      - **3. 发布：发布热更数据：** 发布阶段
        - 发布热更数据
        - 数据发布
      - **4. 测试：** 测试阶段
        - **在测试环境（后台）应用这个版本：** 测试环境
          - 在测试环境应用版本
        - **用测试包进行测试：** 测试包
          - 用测试包测试
          - 验证功能
      - **5. 应用：在正式服应用热更版本：** 应用阶段
        - 在正式服应用热更版本
        - 正式发布
    - 建立规范的发布流程
    - 包含准备、制作、发布、测试、应用等阶段
    - 确保发布质量

- **如何保证发布质量？**
  - **问题**：需要保证发布质量，避免问题版本上线
  - **解决方向**：
    - **质量保证：** 质量机制
      - **测试环节很重要，避免问题版本上线：** 测试重要性
        - 测试环节很重要
        - 避免问题版本上线
      - **需要支持测试环境和正式环境的切换：** 环境切换
        - 支持测试环境
        - 支持正式环境
        - 环境切换
    - 重视测试环节，避免问题版本上线
    - 支持测试环境和正式环境的切换
    - 确保发布质量

**要点和思考方向：**
- 热更发布要有规范的流程，确保质量
- 测试环节很重要，避免问题版本上线
- 需要支持测试环境和正式环境的切换
- 建立规范的发布流程，确保发布质量
- 重视测试环节，避免问题版本上线
- 支持测试环境和正式环境的切换

## 大版本发布

**是什么？在哪用？**

- **作用**：处理大版本更新时的热更新策略，确保版本兼容性
- **应用场景**：
  - 大版本更新
  - 版本兼容性处理
  - 更新策略制定

**会遇到哪些问题？用什么解决？**

- **如何处理版本兼容性？**
  - **问题**：大版本更新时，老版本客户端可能不兼容新热更
  - **解决方向**：
    - **兼容性处理：** 兼容方案
      - **如果老版本客户端兼容新热更：则直接制作、发布、应用最新内容的热更：** 兼容情况
        - 老版本兼容新热更
        - 直接制作、发布、应用最新内容的热更
      - **如果老版本客户端不兼容新热更：则只针对最新的包开启热更检查。并在合适的时机开启包更新提醒，比如3天内非强制更新提醒，3天后强制更新提醒：** 不兼容情况
        - 老版本不兼容新热更
        - 只针对最新包开启热更检查
        - 3天内非强制更新提醒
        - 3天后强制更新提醒
    - 评估老版本客户端兼容性
    - 如果兼容，直接制作、发布、应用最新内容的热更
    - 如果不兼容，只针对最新包开启热更检查，并制定更新提醒策略

- **如何制定更新策略？**
  - **问题**：需要制定合理的更新策略
  - **解决方向**：
    - **更新策略：** 策略制定
      - **需要制定合理的更新策略，平衡用户体验和版本统一：** 策略平衡
        - 平衡用户体验
        - 平衡版本统一
        - 制定合理策略
      - **强制更新要谨慎，避免用户流失：** 强制更新
        - 强制更新要谨慎
        - 避免用户流失
        - 合理设置强制更新时机
    - 制定合理的更新策略
    - 平衡用户体验和版本统一
    - 谨慎使用强制更新，避免用户流失

**要点和思考方向：**
- 大版本发布要考虑老版本兼容性
- 需要制定合理的更新策略，平衡用户体验和版本统一
- 强制更新要谨慎，避免用户流失
- 评估老版本兼容性，制定相应的热更策略
- 制定合理的更新策略，平衡用户体验和版本统一
- 谨慎使用强制更新，避免用户流失
