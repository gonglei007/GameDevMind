<h2 align="center">网络维护</h2>
<p>
关于网络连接、故障、速度等维护相关事项。
</p>

**关键词:**<br/> 
*全球加速,CDN,负载均衡,NAT网关,dig,ping,telnet,mtr*

**标签:**<br/>
*等级: 中级, 阶段: 运营, 分类: 运营能力, 角色: 运维|服务端开发*

## 图谱
![图片加载中...](../../exports/6.1.1.网络维护.png?raw=true)

## 子主题

### 域名解析

**是做什么的？在哪用？**

- **DNS（域名解析）**：将域名转换为IP地址的基础服务，是游戏服务访问的入口
- **HTTP DNS**：基于HTTP协议的域名解析服务，用于移动端，避免运营商Local DNS的域名劫持和跨网访问问题
- **应用场景**：游戏服务器入口域名解析、多线路加速IP解析

**会遇到哪些问题？用什么解决？**

- **问题**：域名劫持、跨网访问慢、单点故障
- **解决方案**：
  - 使用HTTP DNS避免Local DNS劫持
  - 支持多IP解析，提供多个加速线路，前端可策略选择
  - 使用Anycast、Unicast技术提升解析稳定性
  - 结合CDN Pop节点优化解析路径

**要点和思考方向**

- 更多线路意味着可以更精确判断用户网络质量
- 付费和免费DNS服务在稳定性和功能上有差异
- 一个产品可设定多个加速线路，提供多个IP解析时，前端可根据策略选择

### 全球加速-动态加速

**是做什么的？在哪用？**

- **作用**：实现跨地区网络访问的动态加速，让游戏服务器支持跨区域用户访问
- **应用场景**：游戏服务器需要支持全球用户访问，特别是实时性要求高的游戏

**会遇到哪些问题？用什么解决？**

- **延迟问题**：
  - 普通游戏体验：200ms以下
  - 实时性高的游戏：35ms以下
- **成本问题**：全球网络加速费用占比很高
- **解决方案**：
  - 使用加速通道、线路解析、回源、边缘节点等技术
  - 价格优化：让服务器靠近用户占比更高的区域
  - 支持HTTP、TCP/UDP等加速协议
  - 与域名解析配合，为不同服务商解析到不同加速线路

**要点和思考方向**

- 加速通道、线路解析、回源、边缘节点的配置和选择
- 与域名解析配合使用，实现更灵活的加速策略
- 候选服务商：腾讯云GAAP、阿里云、网宿、橙域网络等

### 静态加速-CDN

**是做什么的？在哪用？**

- **作用**：实现游戏静态资源下载加速
- **应用场景**：
  - 游戏包分发
  - 热更资源存储
  - 游戏内动态下载数据

**会遇到哪些问题？用什么解决？**

- **问题**：新上传数据未预热、更新文件未刷新导致用户访问旧资源
- **解决方案**：
  - 新上传的数据要预热
  - 更新的文件要刷新
  - 注意每日预热有上限额度

**要点和思考方向**

- CDN主要用于静态资源加速，不适合动态业务
- 预热和刷新是CDN使用中的关键操作
- 需要关注CDN的预热额度限制

### 网络线路排查

**是做什么的？在哪用？**

- **作用**：排查网络连接问题，定位故障点
- **应用场景**：玩家无法连接、延迟高、掉线等网络问题排查

**会遇到哪些问题？用什么解决？**

- **常用排查方法**：
  - `dig`：检查域名解析是否正确
  - `ping`：排查解析地址和连接质量
  - `telnet`：排查端口是否开放
  - `mtr`：排查线路路由问题
- **排查工具**：
  - 网络万用表APP
  - 腾讯华佗诊断工具

**要点和思考方向**

- **检查路径**（从外到内）：
  1. 玩家切换Wifi/4G试试
  2. 玩家自身网络是否有问题？
  3. 玩家端解析的地址对不对？是否走的加速IP？
  4. 加速本身有没有问题？（需要加速服务商协助检查）
  5. 服务器内部有没有问题？
     - 有没有性能问题？
     - 服务之间的访问有没有问题？是否走了外网？

- **产品网络路径举例**：
  - **国内网络**：域名解析 → 高防（防DDOS攻击） → 负载均衡（隐藏服务） → 游戏服务
  - **全球网络**：域名解析（要为DNS做加速） → 高防（防DDOS攻击） → 全球加速（要为服务做加速） → 负载均衡（隐藏服务） → 游戏服务

### 网络测速

**是做什么的？在哪用？**

- **作用**：测试网络传输速度和质量，定位网络瓶颈
- **应用场景**：评估加速效果、排查网络性能问题

**会遇到哪些问题？用什么解决？**

- **测试路径**：
  - 玩家本地网络：本地网络质量测试、是否接入到正确的加速节点
  - 加速线路
  - 服务器本地网络
  - 服务器业务处理时长
- **测速工具**：
  - `iperf3`：网络传输速度测试
    - 在服务器上启动服务端
    - 在测速机器上调用客户端测试数据传输速度

**要点和思考方向**

- **时间同步问题**：客户端与服务端时间无法高精度一致，因为网络传输的精确时长无法确定，客户端无法正确获取服务器的精确时间
- **处理方式**：通常使用本地时间差来记录分析问题

### 负载均衡（SLB）

**是做什么的？在哪用？**

- **作用**：
  - 统一服务入口
  - 隐藏业务服务器（公网IP），降低被攻击的可能性
  - 轮询主机，解决高可用问题
- **应用场景**：作为游戏服务端业务的总入口

**要点和思考方向**

- 负载均衡是游戏服务架构中的重要组件
- 通过隐藏真实服务器IP，提升安全性
- 通过多主机轮询，提升服务可用性

### 云联网

**是做什么的？在哪用？**

- **作用**：让云上私有网络间（VPC）、VPC与本地数据中心间（IDC）内网互联
- **应用场景**：
  - 绕开故障线路：假设服务器在A点，从地区B到达服务A发生网络故障，但从地区C到达A没有问题，可在C和A之间建立云联网，让地区B的用户先到达地区C，再转至服务器A
  - 游戏加速：实现玩家就近接入POP点，然后走内部通道到达服务器源站
  - 企业内网和云服务之间的连通

**要点和思考方向**

- 云联网提供内网级别的网络连接，延迟和稳定性更好
- 可用于网络故障时的备用路径
- 可用于优化游戏加速路径

### NAT网关

**是做什么的？在哪用？**

- **作用**：在公有VPC子网中使用NAT网关可允许私有子网中的实例发出出站Internet流量
- **应用场景**：各种游戏服务器都会被配置到私有网络中，私有网络中的主机无法访问外网。如果有机器需要访问外部网络，就需要配置NAT网关

**要点和思考方向**

- NAT网关是私有网络访问外网的桥梁
- 游戏服务器通常配置在私有网络中，提升安全性
- 需要访问外网的服务器（如需要调用第三方API）需要配置NAT网关

## 更多资料
### 辅助工具
* [华佗诊断分析系统](https://ping.huatuo.qq.com/)