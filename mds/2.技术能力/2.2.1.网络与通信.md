<h2 align="center">网络与通信</h2>
<p>
对于网络游戏来说，网络是一个核心技术支撑，有客户端跟服务端的通信，也有各个服务之间的通信，通信的方式也是多种多样。那么哪种通信方式适合于哪种情景呢？
</p>

**关键词:**<br/>
*协议,消息,RPC,并发,负载,Session,Socket,消息队列,REST,WebSocket,心跳,粘包*

----
## 网络应用

### 协议

### 是什么？在哪用？

- **HTTP**
  - **应用举例**：轻度游戏

- **TCP**
  - **WebSocket**：基于TCP的WebSocket协议
  - **socket.io**：基于WebSocket的实时通信库
  - **应用举例**：MMORPG

- **UDP**
  - **应用场景**：实时响应要求高的游戏
  - **应用举例**：FPS游戏

### 会遇到哪些问题？

- **协议选择**
  - **问题**：不同游戏类型需要不同的网络协议
  - **解决方向**：
    - 轻度游戏可以使用HTTP
    - MMORPG等需要长连接的可以使用TCP/WebSocket
    - 实时性要求高的游戏（如FPS）可以使用UDP

### 安全

### 是什么？在哪用？

- **加密解密**：保护数据传输安全
- **SSL**：安全套接层，提供加密通信

### 连接

### 是什么？在哪用？

- **握手**：建立连接的过程

- **心跳**
  - **作用**：定时查看客户端跟服务器的连接状态。如果长时间没有心跳，将连接断掉
  - **应用**：保持长连接，检测连接状态

### 消息

### 是什么？在哪用？

### 粘包、半包

### 会遇到哪些问题？用什么解决？

- **问题**：TCP是流式协议，数据包可能会粘在一起或分片
- **解决方向**：
  - **发送**：使用包头+包体的格式，包头包含包体长度
  - **解包**：根据包头信息正确解析包体

### 压缩

### 是什么？在哪用？

- **protobuf**：高效的二进制序列化格式
- **route**：路由压缩
- **gzip**：通用的数据压缩格式

### Session（会话）

### 是什么？在哪用？

- **作用**：用于存放用户连接信息
- **应用**：管理用户会话状态

### Channel

### 是什么？在哪用？

- **作用**：当后端想向特定客户端或者分组推送消息的时候，可以使用Channel
- **应用举例**：聊天消息

### Route（路由）

### 是什么？在哪用？

- **作用**：将消息路由到对应的处理函数

### 并发

### 是什么？在哪用？

### 解决问题

- **对共有资源的访问（比如内存等）**
  - **问题**：多线程/多进程访问共享资源可能导致数据竞争
  - **解决方向**：使用锁、原子操作、无锁数据结构等同步机制

## 消息队列

### 是什么？在哪用？

### 说明

- **Producer（生产者）**
  - **作用**：生成消息并把消息发送给消息队列

- **Consumer（消费者）**
  - **作用**：从消息队列中接收消息

- **路由**
  - **作用**：将生产者传递的消息根据不同的路由规则传递到对应的队列中

- **Queue（队列）**
  - **作用**：实际存储消息的地方，消费者通过订阅队列来获取队列中的消息

### 特性

### 是什么？在哪用？

- **模式**：生产消费者模式

- **channel**：消息通道

- **管理**：要可以看到整个集群的统计信息并进行管理

- **持久化**：消息持久化存储，防止消息丢失

### 解决问题

### 是什么？在哪用？

- **异步**
  - **作用**：发出一个请求不用等待响应后再处理其它事情

- **解耦**
  - **作用**：各个系统不用互相强依赖

- **削峰**
  - **作用**：一下堆积了太多的任务，不会把自己或其它系统卡住，按照资源限制或可控节奏来一个个处理

- **顺序**
  - **说明**：消息发送的先后顺序，不一定就是消息处理的先后顺序

### 应用场景

### 是什么？在哪用？

- **服务器间的通信**：用于服务器之间的异步消息传递

### 作用

### 是什么？在哪用？

- **防止性能管理失控**：通过消息队列控制消息处理节奏，避免系统过载

### 候选

### 是什么？在哪用？

- **Kafka**：高吞吐量的分布式消息队列

- **RabbitMQ**
  - **说明**：RabbitMQ 是对 AMQP（高级消息队列协议）的实现，成熟可靠并且开源

- **RocketMQ**：阿里巴巴开源的分布式消息中间件

- **ActiveMQ**：Apache的消息中间件

- **NSQ**
  - **特点**：高效轻量、简单、易于分布式扩展

### 会遇到哪些问题？

- **消息队列选择**
  - **问题**：不同消息队列有不同的特点和适用场景
  - **解决方向**：根据项目需求、性能要求、可靠性要求等因素选择合适的消息队列

## 服务器间通信

### 是什么？在哪用？

### 网络

- **HTTP**：基于HTTP协议的通信
- **Socket**：基于Socket的通信

### RPC

### 是什么？在哪用？

- **作用**：
  - 像调用本地方法一样去调用一个远程（服务）的方法
  - 通常用于各个后端服务之间的功能调用

- **特点**：即刻调用，即刻执行

### 会遇到哪些问题？

- **资源的使用与限制**
  - **问题**：RPC调用需要考虑资源限制
  - **考虑因素**：
    - **内存**：内存使用限制
    - **线程**：线程池大小限制

### REST

### 是什么？在哪用？

- **说明**：REST API 遵循传统的 CRUD 理念，请求通过 GET、POST、PUT 或 DELETE 操作与资源交互

- **特点**：
  - 可扩展性、高性能、可移植性、可靠性
  - 跨各种技术堆栈使用时相对简单

## 更多资料

### 资料库
* [Game Networking Resources](https://github.com/ThusSpokeNomad/GameNetworkingResources) - 里面集合了跟游戏网络开发相关的很多资料。

### 视频资料
* [TCP/IP 网络通信之 Socket 编程入门](https://www.youtube.com/watch?v=ST6WLZFSHXs)
* [System Design: Why is Kafka fast?](https://www.youtube.com/watch?v=UNUz1-msbOM)

### 文章资料
* [What's the Difference Between RPC and REST?](https://nordicapis.com/whats-the-difference-between-rpc-and-rest/#:~:text=The%20most%20fundamental%20difference%20between,handling%20large%20quantities%20of%20data.) - 简单介绍了RPC和REST，并比较了它们的差异。
* [RPC vs. Messaging – which is faster?](https://particular.net/blog/rpc-vs-messaging-which-is-faster#:~:text=Systems%20built%20on%20message%20queues,requests%2C%20it%20uses%20durable%20disks.)